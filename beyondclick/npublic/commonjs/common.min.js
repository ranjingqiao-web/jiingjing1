"use strict";
var smsFlag = !1
  , smsShowFun = null
  , hasScroll = !1
  , isWeixin = function() {
    return "micromessenger" == navigator.userAgent.toLowerCase().match(/MicroMessenger/i)
};
function getmeta(e) {
    for (var t, n = document.getElementsByTagName("meta"), a = 0; t = n[a++]; )
        if (t.getAttribute("name") && t.getAttribute("name").toLowerCase() === e)
            return encodeURIComponent(t.content)
}
function gray() {
    $require(["cmsAjax"], function(e) {
        var t = window.location.origin + "/ndesigner/api/gray";
        e.cmsAjax.postJson(t).then(function(e) {
            200 == e.code && ($("html")[0].style = "filter:progid:DXImageTransform.Microsoft.Basiclmage(grayscale=1);-webkit-filter:grayscale(100%);")
        })
    })
}
function festival() {
    isFrontEnv() && $require(["cmsAjax"], function(e) {
        e.cmsAjax.get("/fwebapi/cms/lowcode/festivalPendant/getSettings").then(function(e) {
            var t;
            e.data && 200 == e.data.code && e.data.settings && (1 == (t = e.data.settings).location && window.pageObj && 1 != window.pageObj.isHomePage || (e = t.showTime && 2 == t.showTime.length && t.nowTime >= t.showTime[0] && t.nowTime <= t.showTime[1] || !t.showTime || 0 == t.showTime.length,
            t.isOpen && e && $require(["/npublic/commonjs/restival.js"], function(e) {
                e.init(t)
            })))
        })
    })
}
function smartServiceInit() {
    isFrontEnv() && $(window).on("mousemove scroll touchmove tap click keydown", function() {
        var a;
        hasScroll || (hasScroll = !0,
        a = function(i) {
            $require(["css!/npublic/commonjs/smartService/t.css", "/npublic/commonjs/smartService.js"], function(e, t) {
                var n = {};
                try {
                    n = JSON.parse(i.setting.colorLayout)
                } catch (e) {}
                1 == n.entranceLocation && (a = '<a href="javascript:;" smartService class="smartIcon '.concat("left" == n.windowLocation ? "leftIcon" : "", '" style="color:').concat(n.windowColor, ';">\n                            <svg t="1691993598192" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="814" width="200" height="200"><path d="M508.30872719 128.08273435c200.36824869 0 362.83837999 164.57253407 362.83837996 367.57335931 0 203.01910646-162.45184851 367.59164208-362.83837996 367.59164209v-55.13783256c170.33129377 0 308.41353791-139.89213981 308.41353633-312.43552832 0-172.57995248-138.08224413-312.45380951-308.41353633-312.45380952s-308.41353791 139.89213981-308.41353791 312.43552831c0 5.48453223 0.12797313 10.93250049 0.40219903 16.34390634H145.81770106c-0.23766351-5.41140585-0.36563506-10.8593741-0.36563663-16.34390634C145.45206443 292.65526841 307.94047692 128.08273435 508.32700838 128.08273435z" p-id="815"></path><path d="M508.30872719 240.40595711c139.16086813 0 251.95941786 114.27937278 251.95941629 255.25013655 0 140.98904501-112.79854975 255.26841777-251.95941629 255.26841777-36.65495788 0-71.46345612-7.91600767-102.87154529-22.1757924l-65.81438835 34.62568148c-9.89044049 5.19202354-22.06610207 1.27972351-27.18499926-8.72040577a20.65840542 20.65840542 0 0 1-2.01099519-12.76067896l12.10253519-73.76696156a256.18250777 256.18250777 0 0 1-66.18002497-172.47026056c0-140.97076381 112.79854975-255.25013657 251.95941787-255.25013655zM381.28695667 446.66093709c-24.4975775 0-44.33330364 20.10995203-44.33330366 44.91832098 0 24.80836739 19.85400733 44.91831942 44.33330366 44.91831943 24.4975775 0 44.35158484-20.10995203 44.35158486-44.91831943 0-24.80836739-19.85400733-44.91831942-44.35158486-44.91832098z m127.00348775 0c-24.4975775 0-44.35158484 20.10995203-44.35158488 44.91832098 0 24.80836739 19.85400733 44.91831942 44.35158488 44.91831943s44.33330364-20.10995203 44.33330363-44.91831943c0-24.80836739-19.85400733-44.91831942-44.33330363-44.91832098z m126.98520652 0c-24.4975775 0-44.35158484 20.10995203-44.35158484 44.91832098 0 24.80836739 19.85400733 44.91831942 44.35158484 44.91831943s44.35158484-20.10995203 44.35158484-44.91831943c0-24.80836739-19.85400733-44.91831942-44.35158484-44.91832098zM183.47815657 388.70771279l43.82141265 251.79488075a34.91819015 34.91819015 0 0 1-27.33125199 40.36615843l-0.65814374 0.10969033c-62.21287819 11.11531881-121.53723669-30.96932612-132.50630275-93.9866024L56.71233074 529.00205007c-10.96906446-63.03555904 30.5671271-123.12775168 92.79828807-134.24307046l33.96753776-6.06954959zM840.52513489 388.70771279L790.707299 674.89061152l33.98581895 6.06954959c62.21287819 11.11531881 121.53723669-30.96932612 132.50630273-93.98660398l10.09153845-57.97150706c10.96906446-63.03555904-30.5671271-123.12775168-92.7982881-134.24307046l-33.96753614-6.06954959zM464.96263993 808.10990319h86.6738933c23.94912413 0 43.32780605 19.65290783 43.32780446 43.89454063 0 24.25991557-19.37868034 43.91282183-43.32780446 43.91282183h-86.6556121c-23.94912413 0-43.36437003-19.65290783-43.36437003-43.91282183 0-24.2416328 19.41524431-43.89454063 43.34608883-43.89454063z" p-id="816"></path></svg>\n                        </a>'),
                $("body").append(a),
                $(".smartIcon").hover(function() {
                    $(this).css({
                        "background-color": n.windowColor,
                        color: "#fff"
                    })
                }, function() {
                    $(this).css({
                        "background-color": "#fff",
                        color: n.windowColor
                    })
                })),
                $(document).on("click", "[smartService]", o);
                var a = sessionStorage.getItem("smartServiceClose");
                function o() {
                    if (smsShowFun)
                        return 0 < $(".smartService.show").length ? void smsShowFun.closeDialog() : void (smsFlag ? smsShowFun.showFun() : smsShowFun());
                    var e;
                    smsFlag = !0,
                    smsShowFun = new t(i),
                    window.ZQSensorsObj && (e = {
                        tenantId: tenant.tenantId,
                        iBusinessCode: "01",
                        iBusinessName: "智慧客服业务线",
                        iBusinessCustId: localStorage.getItem("account_".concat(tenant.tenantId))
                    },
                    ZQSensorsObj.track("SmartServiceWakeUp", e))
                }
                1 == n.showFlag && i && "true" != a && o()
            })
        }
        ,
        $require(["cmsAjax"], function(e) {
            var t = __ce.smartServiceUrl || "https://web-visitor.yun300.cn"
              , n = "".concat(t, "/visitormanager/intelligent/front/checkAndRegister?tenantId=").concat(tenant.tenantId, "&instance=").concat(tenant.bossProductInstance)
              , t = {
                account: localStorage.getItem("account_".concat(tenant.tenantId))
            };
            e.cmsAjax.postJson(n, t).then(function(e) {
                200 == e.status && e.data && (localStorage.setItem("account_".concat(tenant.tenantId), e.data.account),
                a(e.data))
            })
        }))
    })
}
function preventFish() {
    var e = location.hostname
      , t = getCookie("realhost") || "";
    t && t != e && (t = "/repository/cheat?req=" + e + "&rel=" + t,
    $.ajax({
        url: t
    }))
}
function wxShare() {
    $require(["cmsAjax", "/npublic/commonjs/jweixin/jweixin.js", "pl_util"], function(e) {
        var t = {
            pageUrl: location.href,
            appCode: pageObj.appId,
            tid: pageObj.contentType,
            pageType: pageObj.pageType,
            isHomePage: pageObj.isHomePage,
            pageId: pageObj.pageId,
            contentId: pageObj._detailId,
            pageName: pageObj.name
        };
        e.cmsAjax.postJson("/fwebapi/cms/api/tdk/getWxShareInfo", t).then(function(e) {
            var t, n, a, o = e.data;
            o.data && (o = o.data),
            o.wxJsConfig && (t = o.wxJsConfig,
            a = o.wxShareContent,
            n = {
                title: a.title,
                desc: a.desc,
                link: location.href,
                imgUrl: (e = $.handleDataImg(a.imgUrl),
                o = 104,
                a = -1 < e.indexOf("?") ? e.split("?")[1] : "",
                e = e.split("?")[0],
                a = a ? "?" + a : "",
                e + "_" + o + "xaf" + e.substr(e.lastIndexOf(".")) + a)
            },
            wx.config({
                debug: !1,
                appId: t.appId,
                timestamp: t.timestamp,
                nonceStr: t.nonceStr,
                signature: t.signature,
                jsApiList: ["updateAppMessageShareData", "updateTimelineShareData"]
            }),
            wx.ready(function() {
                wx.updateAppMessageShareData(n),
                wx.updateTimelineShareData(n)
            }))
        })
    })
}
$(function() {
    window.pageObj && 1 == window.pageObj.isHomePage && gray(),
    "portal-saas-mall" != tenant.unittype && (festival(),
    smartServiceInit()),
    268516 != tenant.tenantId && "portal-saas-mall" != tenant.unittype && preventFish(),
    isWeixin() && "portal-saas-mall" != tenant.unittype && wxShare(),
    "miniprogram" === window.__wxjs_environment && $require(["/npublic/commonjs/jweixin/jweixin.js", "pl_util"], function() {
        wx.miniProgram.postMessage({
            data: {
                shareTitle: encodeURIComponent(document.title),
                shareDesc: getmeta("description"),
                shareUrl: encodeURIComponent(location.href)
            }
        })
    })
});
